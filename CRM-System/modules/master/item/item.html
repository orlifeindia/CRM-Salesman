<!DOCTYPE html>
<html>
<head>
  <title>Item Master (ERP Style)</title>
  <link rel="stylesheet" href="item.css">
  <style>
    .suggestion-box div {
      padding: 8px 15px; cursor: pointer; border-bottom: 1px solid #e4f0ec;
      color: #1b858a; font-size: 15px; display:flex; justify-content:space-between; align-items:center; gap: 10px;
    }
    .suggestion-box div:hover { background: #e8fff2; color: #035a32; font-weight:700;}
    .add-new { color:#c04919;font-weight:600;cursor:pointer;background:#fff7ef !important; justify-content: flex-start !important; }
    .edit-btn {
      font-size:15px; background:#eefdff; color:#009; border-radius:4px; border:none;
      padding:4px 9px 4px 7px; margin-left:8px; cursor:pointer; font-weight:bold; transition:background .2s;
    }
    .edit-btn:hover { background:#b6ecfc;color:#004;}
  </style>
</head>
<body>
  <div class="erp-box">
    <h2>Item Master</h2>
    <form id="item-form">
        
       

      <div class="erp-grid">
        
        <!-- Column 1 -->
        <div style="position:relative;">
          <label class="erp-label">Item Name</label>
          <input type="text" class="erp-input" id="name" tabindex="1" autocomplete="off" required>
          <div id="item-suggestions" class="suggestion-box" style="display:none;position:absolute;left:0;z-index:60;background:#fff;width:100%;border:1px solid #b2dbea;border-top:none;border-radius:0 0 8px 8px;max-height:180px;overflow-y:auto;box-shadow:0 8px 18px #bdf8;"></div>
          <label class="erp-label">SKU</label>
          <input type="text" class="erp-input" tabindex="2">
        
          
          <label class="erp-label">Group</label>
          <input type="text" class="erp-input" tabindex="4">
          <div class="erp-section">
            <div class="erp-title">Main Unit Details</div>
            <div class="erp-row">
              <label class="erp-label" style="margin-bottom:0;">Unit:</label>
              <select id="unit" class="erp-select" tabindex="5"></select>
            </div>
            <div class="erp-row">
              <label>Op. Stock (Qty):</label>
              <input type="number" class="erp-input" id="opstock" step="0.001" tabIndex="6">
              <label>Op. Stock (Value):</label>
              <input type="number" class="erp-input" id="opvalue" step="0.01" readOnly tabIndex="7">
            </div>
          </div>
          <div class="erp-section">
            <div class="erp-title">Alternate Unit Details</div>
            <div class="erp-row">
              <label class="erp-label" style="margin-bottom:0;">Alt. Unit:</label>
              <select id="altunit" class="erp-select" tabIndex="8"></select>
              <label>Con. Factor:</label>
              <input type="number" class="erp-input" id="confactor" step="0.001" tabIndex="9">
            </div>
          </div>
        </div>
        <!-- Column 2 -->
        <div>
          <label class="erp-label">Tax Category</label>
          <input type="text" class="erp-input" tabIndex="10">
          <div class="erp-row">
            <input type="text" class="erp-input" placeholder="HSN/SAC Code" tabIndex="11">
            <button class="btn" type="button" style="background:#beb9e0">Search</button>
          </div>
          <div class="erp-section">
            <div class="erp-title">Item Price Info</div>
            <div class="erp-row"><label>Main Sales Price:</label><input type="number" class="erp-input"
                step="0.01" tabIndex="12"></div>
            <div class="erp-row"><label>MRP:</label><input type="number" class="erp-input" step="0.01"
                tabIndex="13"></div>
            <div class="erp-row"><label>Self-Val. Price:</label><input type="number" class="erp-input"
                step="0.01" tabIndex="14"></div>
          </div>
        </div>
        <!-- Column 3 -->
        <div style="margin-top:14px;">
          <label>Set Critical Level (Y/N):</label>
          <select class="erp-select" id="critical_level">
            <option value="N" selected>N</option>
            <option value="Y">Y</option>
          </select>
        </div>
        <div id="critical-price-table" style="display:none; margin-top:12px;">
          <label style="font-weight:600;margin-bottom:4px;display:block;">Category Wise Price:</label>
          <table border="1" style="width:85%;">
            <tr>
              <th>Category</th>
              <th>Price</th>
            </tr>
            <tr><td>A</td><td><input type="number" id="price_a" step="0.01" /></td></tr>
            <tr><td>B</td><td><input type="number" id="price_b" step="0.01" /></td></tr>
            <tr><td>C</td><td><input type="number" id="price_c" step="0.01" /></td></tr>
            <tr><td>D</td><td><input type="number" id="price_d" step="0.01" /></td></tr>
          </table>
          <div style="margin-top: 8px;">
            <label>Select Category:</label>
            <select id="cat_category">
              <option>A</option>
              <option>B</option>
              <option>C</option>
              <option>D</option>
            </select>
            <input type="number" id="sale_price" placeholder="Auto Price" readonly
              style="width:90px;margin-left:5px;" />
          </div>
        </div>
        <div class="erp-section" style="margin-top:16px;">
          <div class="erp-title">Status/Options (short)</div>
          <div class="erp-row"><label><input type="checkbox" tabIndex="17"> Maintain BCN</label></div>
          <div class="erp-row"><label><input type="checkbox" tabIndex="18"> Batch-wise Details</label></div>
          <div class="erp-row"><label><input type="checkbox" tabIndex="19"> Don't Maintain Stock Balance</label></div>
        </div>
      </div>
      <div style="margin:22px 0 9px 0;">
        <button class="btn" type="submit" tabindex="20" id="saveBtn">Save</button>
        <button class="btn" type="button" style="background:#c2cad9;color:#1a1c20" tabIndex="21">Quit</button>
      </div>
    </form>
    <div id="result"></div>
  </div>
  <script>
    // Fill dropdowns
    const unitMaster = [
      { code: "Pkt", name: "Packet" }, { code: "Box", name: "Box" }, { code: "Pcs", name: "Piece" }
    ];
    function fillUnits() {
      const unitSel = document.getElementById('unit');
      const altSel = document.getElementById('altunit');
      unitMaster.forEach(u => {
        const opt = document.createElement('option');
        opt.value = u.code; opt.text = u.code + " (" + u.name + ")";
        unitSel.appendChild(opt.cloneNode(true));
        altSel.appendChild(opt.cloneNode(true));
      });
    }
    fillUnits();

    // Navigation: skip submit button for Enter, allow submit!
    document.getElementById('item-form').addEventListener('keydown', function (e) {
      const submitBtn = document.getElementById('saveBtn');
      let inputs = Array.from(this.querySelectorAll('input:not([type=hidden]),select,textarea,button'))
        .filter(el => !el.disabled && el.offsetParent !== null);
      let idx = inputs.findIndex(x => x === document.activeElement);

      if(
        (e.key === 'Enter' || e.key === 'ArrowRight')
        && idx > -1 && idx < inputs.length - 1
        && document.activeElement !== submitBtn
        && document.activeElement.type !== "button"
      ){
        inputs[idx + 1].focus();
        e.preventDefault();
      }

      if(
        (e.key === 'Escape' || e.key === 'ArrowLeft')
        && idx > 0
        && document.activeElement !== submitBtn
        && document.activeElement.type !== "button"
      ){
        inputs[idx - 1].focus();
        e.preventDefault();
      }
    });


    // Op. Stock Value calculation
    document.getElementById('opstock').addEventListener('input', function () {
      document.getElementById('opvalue').value = parseFloat(this.value || 0) * 100;
    });

    // Show/Hide category
    document.getElementById('critical_level').addEventListener('change', function() {
      document.getElementById('critical-price-table').style.display = this.value === 'Y' ? '' : 'none';
    });

    // Category auto price fill
    ['price_a','price_b','price_c','price_d','cat_category','sale_price'].forEach(id =>
      document.getElementById(id) && document.getElementById(id).addEventListener('input', updateSalePrice)
    );
    function updateSalePrice() {
      let cat = document.getElementById('cat_category').value;
      let val = document.getElementById('price_' + cat.toLowerCase()).value;
      document.getElementById('sale_price').value = val || '';
    }

    // ---- Item name search + add + edit (standard) ----
    
    const nameInput = document.getElementById('name');
    const suggestionBox = document.getElementById('item-suggestions');
    nameInput.addEventListener('input', function() {
      const val = this.value.trim();
      const valL = val.toLowerCase();
      if(val.length < 1) { suggestionBox.style.display="none"; return; }
      const result = itemList.filter(i => i.toLowerCase().includes(valL));
      if(result.length) {
        suggestionBox.innerHTML = result.map(i =>
          `<div>
            <span style="flex:1;">${i.name}</span>
            <button type="button" class="edit-btn" onclick="editItemOption('${i.name}')">✏️ Edit</button>
          </div>`).join("");
        suggestionBox.style.display = "block";
      } else {
        suggestionBox.innerHTML = `<div class="add-new" onclick="addNewItemOption()">
          ➕ Add "<span style='color:#176;'>${val.replace(/</g,'&lt;')}</span>" as New Item
        </div>`;
        suggestionBox.style.display = "block";
      }
      Array.from(suggestionBox.children).forEach(el => {
        if (!el.hasAttribute('onclick')) {
          el.onclick = () => {
            nameInput.value = el.innerText.replace('✏️ Edit','').trim();
            suggestionBox.style.display = "none";
          };
        }
      });
    });
    window.addNewItemOption = function() {
      nameInput.value = nameInput.value;
      suggestionBox.style.display = "none";
      alert('You can add this new item logic here!');
    };
    window.editItemOption = function(item) {
      suggestionBox.style.display = "none";
      alert('You can open item edit mode or dialog for: ' + item);
    };
    nameInput.addEventListener('blur', function() {
      setTimeout(()=> { suggestionBox.style.display="none"; }, 150);
    });
  </script>
   <script src="item.js"></script>
</body>
</html>
